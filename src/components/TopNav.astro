---
import SearchBox from "./SearchBox.astro";
import { QUICK_SWITCH } from "../lib/quickSwitch";

type Props = {
  appName?: string;
  showSearch?: boolean;
};

const { appName = "Notebook", showSearch = true } = Astro.props;

const pathname = Astro.url.pathname;

// BASE_URL is "/" in dev, or "/some/subdir/" when mounted
const base = import.meta.env.BASE_URL.replace(/\/?$/, "/");

// Join base + relative href safely (and tolerate old "/daily/" style inputs)
const join = (href: string) => `${base}${href.replace(/^\/+/, "")}`;

// Active when current path starts with the target path (e.g. /daily/... highlights Daily)
const isActive = (href: string) => {
  const targetPath = new URL(join(href), Astro.url.origin).pathname;
  return targetPath !== base && pathname.startsWith(targetPath);
};
---

<header class="topnav" role="banner">
  <div class="topnav__inner">
    <!-- Brand should go to the mounted root, not a hardcoded /notes/ -->
    <a class="topnav__brand" href={base} aria-label="Go to Notes home">
      <span class="topnav__name h2">{appName}</span>
    </a>

    <nav class="seg" aria-label="Quick switch">
      {QUICK_SWITCH.map((item) => {
        const url = join(item.href);
        return (
          <a
            href={url}
            class:list={["seg__item", isActive(item.href) && "is-active"]}
          >
            {item.label}
          </a>
        );
      })}
    </nav>

    {showSearch && (
      <div class="topnav__search" role="search">
        <SearchBox />
      </div>
    )}
  </div>
</header>
